<div id="flooplan-app" class="is-loading">
  <main v-if="!showAddMarkersUI">
    <header>
      <p>Configure your interactive map</p>
    </header>
    <div class="loading-message">
      <div class="spinner-holder animated">
        <div class="spinner-overlay">Loading...</div>
        <p>Loading... Please wait!</p>
      </div>
    </div>
    <section class="app-content">
      <form class="form-horizontal">
        <div class="form-group clearfix floors-form-group">
          <div class="col-sm-12 control-label">
            <label>Add your maps</label>
          </div>
          <div class="col-sm-12">
            <div class="floor-panels-holder">
              <div class="add-floor-panel" @click.prevent="onAddFloor"><i class="fa fa-plus-circle"></i> Add a new map</div>
              <div class="panel-group" id="floor-accordion" v-sortable="{ handle: '.panel-heading', group: { name: 'floorPanels', pull: false }, scrollSensitivity: 116, scrollSpeed: 10, onUpdate: onSortFloors }">
                
                <div v-for="(floor, idx) in floors" v-bind:key="floor.id" class="panel panel-default floor-panel" :data-id="floor.id">
                  <div class="panel-heading">
                    <h4 class="panel-title" v-bind:class="{ 'collapsed': !floor.isFromNew }" data-toggle="collapse" data-parent="#floor-accordion" :data-target="'#collapse-' + floor.id">
                      <div class="screen-reorder-handle">
                        <i class="fa fa-ellipsis-v"></i><i class="fa fa-ellipsis-v"></i>
                      </div>
                      <span class="panel-title-text">\{{floor.name}}</span>
                      <span class="fa panel-chevron fa-chevron-up"></span>
                    </h4>
                    <a href="#" @click.prevent="deleteFloor(idx)"><span class="icon-delete fa fa-trash"></span></a>
                  </div>
                  <div :id="'collapse-' + floor.id" class="panel-collapse collapse" v-bind:class="{ in: floor.isFromNew }">
                    <div class="panel-body">
                      <div class="error-holder" v-if="floor.error">\{{floor.error}}</div>

                      <component :is="floor.type" v-bind="floor"></component>

                    </div>
                  </div>
                </div>

              </div>
            </div>
          </div>
        </div>

        <div class="form-group clearfix markers-form-group">
          <div class="col-sm-12 control-label">
            <label>Create marker styles</label>
          </div>
          <div class="col-sm-12">
            <div class="floor-markers-holder">
              <div class="add-floor-marker" @click.prevent="onAddMarker"><i class="fa fa-plus-circle"></i> Add a new marker style</div>
              <div class="panel-group" id="markers-accordion">
                
                <div v-for="(marker, idx) in markers" v-bind:key="marker.id" class="panel panel-default marker-panel" :data-id="marker.id">
                  <div class="panel-heading">
                    <h4 class="panel-title" v-bind:class="{ 'collapsed': !marker.isFromNew }" data-toggle="collapse" data-parent="#markers-accordion" :data-target="'#collapse-' + marker.id">
                      <span class="panel-title-text">\{{marker.name}}</span>
                      <span class="fa panel-chevron fa-chevron-up"></span>
                    </h4>
                    <a href="#" @click.prevent="deleteMarker(idx)"><span class="icon-delete fa fa-trash"></span></a>
                  </div>
                  <div :id="'collapse-' + marker.id" class="panel-collapse collapse" v-bind:class="{ in: marker.isFromNew }">
                    <div class="panel-body">
                      <div class="error-holder" v-if="marker.error">\{{marker.error}}</div>

                      <component :is="marker.type" v-bind="marker"></component>

                    </div>
                  </div>
                </div>

              </div>
            </div>
          </div>
        </div>
        <div class="form-group clearfix add-markers-form-group">
          <div class="col-sm-4 control-label">
            <label>Add markers to your map(s)</label>
          </div>
          <div class="col-sm-8">
            <div class="btn btn-default" @click.prevent="openAddMarkers">Mark floor(s)</div>
            <p v-if="hasError" class="text-danger">You need to add at least one map and one marker style before continuing.</p>
          </div>
        </div>
      </form>
    </section>
  </main>
  <main v-else>
    <header>
      <div class="title-holder">
        <div class="go-back" @click.prevent="goBackToSettings"><i class="fa fa-angle-left"></i> Back to settings</div>
        <p>Add markers</p>
      </div>
    </header>
    <div class="add-markers-wrapper">
      <component is="add-markers" v-bind="{
        widgetData: settings,
        dataSources: dataSources,
        markersDataSourceId: settings.markersDataSourceId,
        markerNameColumn: settings.markerNameColumn,
        markerFloorColumn: settings.markerFloorColumn,
        markerTypeColumn: settings.markerTypeColumn,
        markerXPositionColumn: settings.markerXPositionColumn,
        markerYPositionColumn: settings.markerYPositionColumn,
        autoDataSource: settings.autoDataSource
      }"></component>
    </div>
  </main>
</div>